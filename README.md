# Nüwa

Nüwa, the first LLM-based approach for MLIR fuzzing. 

## License  
This project is licensed under the Apache License 2.0.  
See [LICENSE.md](LICENSE.md) for details.  
 
## Get started

``` bash
git clone https://github.com/anonymity88/nvwa.git
cd nvwa
# Set up the llvm-project
git clone https://github.com/llvm/llvm-project.git
cd llvm-project
git checkout bec839d8eed9dd13fa7eaffd50b28f8f913de2e2
rm -r build
mkdir build
cd build
cmake -G Ninja ../llvm \
    -DLLVM_ENABLE_PROJECTS=mlir \
    -DLLVM_TARGETS_TO_BUILD="X86" \
    -DCMAKE_BUILD_TYPE=Release \
    -DLLVM_ENABLE_ASSERTIONS=ON \
    -DCMAKE_C_COMPILER=/root/clang+llvm-17.0.4-x86_64-linux-gnu-ubuntu-22.04/bin/clang \
    -DCMAKE_CXX_COMPILER=/root/clang+llvm-17.0.4-x86_64-linux-gnu-ubuntu-22.04/bin/clang++\
    -DCMAKE_C_FLAGS="-g -O0 -fprofile-arcs -ftest-coverage" \
    -DCMAKE_CXX_FLAGS="-g -O0 -fprofile-arcs -ftest-coverage" \
    -DCMAKE_EXE_LINKER_FLAGS="-g -fprofile-arcs -ftest-coverage -lgcov" \
    -DLLVM_PARALLEL_LINK_JOBS=2

ninja -j 40
```

## Use Nüwa

With Nüwa, you can easily generate test cases based on the operator specifications in the `specifications` directory. First, you need to modify the proxy settings and the large model API key in the generate/generate_utils.py file. Then, you can start generating test cases with a single command:
```bash
python generate/main.py --opt MLIRGensyn --seeds 100 --date test
```

After generation, use the testing module to perform fuzz testing (500 test cases generated by Deepseek have already been uploaded to the repository, and you can directly start fuzz testing with the following command):
```bash
python fuzz/fuzz.py
```

Post-process the results and automatically de-duplicate crashes:
```bash
python fuzz/coverage/BugReport.py
```

## code structure
```tree
nvwa/
├── README.md               # Project overview
├── LICENSE                 # Apache 2.0 license text
├── fuzz                    # Fuzz testing module
│   ├── coverage            # Fuzzing analysis tools: coverage, crash de-duplication, etc.
│   ├── draw                # Statistical charting and visualization tools
│   └── fuzz.py             # Main fuzzing program
├── generate                # Test case generation module
│   ├── generate_utils.py   # Base utilities for generators and mutators
│   ├── generate.py         # Generator implementation
│   ├── mutate.py           # Mutator implementation
│   └── main.py             # Main test case generation program
├── llvm-project     
├── prompt                  # Prompt templates for each generation/mutation phase
├── prompt                  # Utility scripts for preprocessing and experimentation
├── specifications          # MLIR dialect operator specifications (organized by dialect and operator)
└── requirements.txt        # The python environment for developers using this project.
```
